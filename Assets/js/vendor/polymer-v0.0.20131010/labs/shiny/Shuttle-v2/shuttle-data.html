<!--
/*
 * Copyright 2013 The Polymer Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style
 * license that can be found in the LICENSE file.
 */
-->

<link rel="import" href="../../../polymer-elements/polymer-localstorage/polymer-localstorage.html">

<polymer-element name="shuttle-data" attributes="route officeStops remoteStops favorites">
  <template>
    <polymer-localstorage id="storage" name="{{isMock ? shuttle-mock-storage : shuttle-storage6}}" value="{{userData}}" 
        autoSaveDisabled on-polymer-localstorage-load="populateUserData"></polymer-localstorage>
  </template>
  <script>
    (function() {
      var MOCK_OFFICE_SELECTED = 'San Francisco City Hall';
      var MOCK_REMOTE_SELECTED = 'Kimberly Park, American Canyon';
      var OFFICE_SELECTED = 'Main Campus (B40-43)';
      var REMOTE_SELECTED = '18th St @ Castro';
      
      Polymer('shuttle-data', {
        isMock: Shuttle.isMock,
        created: function() {
          this.populateStops();
        },
        populateStops: function() {
          Shuttle.stops.forEach(function(s, i) {
            s.index = i;
          });
          this.officeStops = Shuttle.stops.filter(function(s) {
            return s.is_work;
          });
          // office/campus stops
          this.officeStops = JSON.parse(JSON.stringify(this.officeStops));
          // all stops
          this.remoteStops = JSON.parse(JSON.stringify(Shuttle.stops));
        },
        populateUserData: function() {
          if (!this.userData) {
            this.userData = {
              route: {},
              favorites: []
            };
          }
          this.favorites = this.userData.favorites;
          this.route = this.userData.route;
          this.route.officeSelected = Shuttle.isMock ? MOCK_OFFICE_SELECTED : 
              (this.route.officeSelected || OFFICE_SELECTED);
          this.route.remoteSelected = Shuttle.isMock ? MOCK_REMOTE_SELECTED : 
              (this.route.remoteSelected || REMOTE_SELECTED);
        },
        save: function() {
          if (!Shuttle.isMock) {
            this.$.storage.save();
          }
        }
      });
    })();
  </script>
</polymer-element>